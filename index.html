<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crud Railway</title>
</head>
<body>

    <h2>CRUD Básico (Railway)</h2>

    <input id="addItem" placeholder="Nome do item">
    <button onclick="add()">Adicionar</button><br><br>

    <input id="editPos" placeholder="ID do item">
    <input id="editItem" placeholder="Novo nome">
    <button onclick="edit()">Editar</button><br><br>

    <input id="delPos" placeholder="ID do item">
    <button onclick="delItem()">Deletar</button><br><br>

    <button onclick="show()">Visualizar</button>
    <pre id="lista"></pre>

<script>
// No Railway, a URL deve ser relativa para funcionar em produção e local
const URL = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1" 
            ? "http://localhost:3001/items" 
            : "/items";

async function show() {
  const res = await fetch(URL);
  const data = await res.json();
  document.getElementById("lista").innerText =
    data.map(item => `${item.id} - ${item.name}`).join("\n");
}

async function add() {
  const name = document.getElementById("addItem").value;
  await fetch(URL, { 
    method: "POST", 
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name }) 
  });
  document.getElementById("addItem").value = "";
  show();
}

async function edit() {
  const id = document.getElementById("editPos").value;
  const name = document.getElementById("editItem").value;
  await fetch(`${URL}/${id}`, { 
    method: "PUT", 
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name }) 
  });
  document.getElementById("editPos").value = "";
  document.getElementById("editItem").value = "";
  show();
}

async function delItem() {
  const id = document.getElementById("delPos").value;
  await fetch(`${URL}/${id}`, { method: "DELETE" });
  document.getElementById("delPos").value = "";
  show();
}

show();
</script>
</body>
</html>